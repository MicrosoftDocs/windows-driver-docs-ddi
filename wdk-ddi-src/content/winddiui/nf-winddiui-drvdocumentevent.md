---
UID: NF:winddiui.DrvDocumentEvent
title: DrvDocumentEvent function (winddiui.h)
description: A printer interface DLL's DrvDocumentEvent function can handle certain events associated with printing a document.
old-location: print\drvdocumentevent.htm
tech.root: print
ms.assetid: 09229774-14db-448b-bd49-2d39a848c9a6
ms.date: 04/20/2018
ms.keywords: DrvDocumentEvent, DrvDocumentEvent function [Print Devices], print.drvdocumentevent, print_interface-graphics_ffc39ed1-d1b8-4e3d-b0a3-515b90cd6c8f.xml, winddiui/DrvDocumentEvent
ms.topic: function
req.header: winddiui.h
req.include-header: Winddiui.h
req.target-type: Desktop
req.target-min-winverclnt: 
req.target-min-winversvr: 
req.kmdf-ver: 
req.umdf-ver: 
req.ddi-compliance: 
req.unicode-ansi: 
req.idl: 
req.max-support: 
req.namespace: 
req.assembly: 
req.type-library: 
req.lib: 
req.dll: 
req.irql: 
topic_type:
- APIRef
- kbSyntax
api_type:
- HeaderDef
api_location:
- winddiui.h
api_name:
- DrvDocumentEvent
product:
- Windows
targetos: Windows
req.typenames: 
---

# DrvDocumentEvent function


## -description


A printer interface DLL's <b>DrvDocumentEvent</b> function can handle certain events associated with printing a document.


## -parameters




### -param hPrinter

Caller-supplied printer handle.


### -param hdc

Caller-supplied device context handle, generated by a <b>CreateDC</b> (described in the Windows SDK documentation) call. This is zero if <i>iEsc</i> is set to DOCUMENTEVENT_CREATEDCPRE. For restrictions on printing from a 32-bit application on a 64-bit version of Windows, see the following Remarks section.


### -param iEsc

Caller-supplied escape code identifying the event to be handled. This parameter can be one of the following integer constants. See the Windows SDK documentation for descriptions of the functions listed in the Event column.

For restrictions on printing from a 32-bit application on a 64-bit version of Windows, see the following Remarks section.

<table>
<tr>
<th><b>iEsc</b> Constant</th>
<th>Event</th>
</tr>
<tr>
<td>
DOCUMENTEVENT_ABORTDOC

</td>
<td>
GDI is about to process a call to its <b>AbortDoc</b> function.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_CREATEDCPOST

</td>
<td>
GDI has just processed a call to its <b>CreateDC</b> or <b>CreateIC</b> function.

This escape code should not be used unless there has been a previous call to <b>DrvDocumentEvent</b> with <i>iEsc</i> set to DOCUMENTEVENT_CREATEDCPRE.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_CREATEDCPRE

</td>
<td>
GDI is about to process a call to its <b>CreateDC</b> or <b>CreateIC</b> function.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_DELETEDC

</td>
<td>
GDI is about to process a call to its <b>DeleteDC</b> function.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_ENDDOCPOST

</td>
<td>
GDI has just processed a call to its <b>EndDoc</b> function.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_ENDDOCPRE 

or

DOCUMENTEVENT_ENDDOC

</td>
<td>
GDI is about to process a call to its <b>EndDoc</b> function.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_ENDPAGE

</td>
<td>
GDI is about to process a call to its <b>EndPage</b> function.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_ESCAPE

</td>
<td>
GDI is about to process a call to its <b>ExtEscape</b> function.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_QUERYFILTER

</td>
<td>
The DOCUMENTEVENT_QUERYFILTER event represents an opportunity for the spooler to query the driver for a list of the DOCUMENTEVENT_<i>XXX</i> events to which the driver will respond. This event is issued just prior to a call to <b>DrvDocumentEvent</b> that passes the DOCUMENTEVENT_CREATEDCPRE event.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_RESETDCPOST

</td>
<td>
GDI has just processed a call to its <b>ResetDC</b> function.

This escape code should not be used unless there has been a previous call to <b>DrvDocumentEvent</b> with <i>iEsc</i> set to DOCUMENTEVENT_RESETDCPRE.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_RESETDCPRE

</td>
<td>
GDI is about to process a call to its <b>ResetDC</b> function.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_STARTDOCPOST

</td>
<td>
GDI has just processed a call to its <b>StartDoc</b> function.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_STARTDOCPRE 

or

DOCUMENTEVENT_STARTDOC

</td>
<td>
GDI is about to process a call to its <b>StartDoc</b> function.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_STARTPAGE

</td>
<td>
GDI is about to process a call to its <b>StartPage</b> function.

</td>
</tr>
</table>
 


### -param cbIn

Caller-supplied size, in bytes, of the buffer pointed to by <i>pvIn</i>.


### -param pvIn [in]

Caller-supplied pointer, the use of which is dependent on the value supplied for <i>iEsc</i>, as follows:

<table>
<tr>
<th><i>iEsc</i> Constant</th>
<th><i>pvIn</i> Contents</th>
</tr>
<tr>
<td>
DOCUMENTEVENT_ABORTDOC

</td>
<td>
Not used.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_CREATEDCPOST

</td>
<td>
<i>pvIn</i> contains the address of a pointer to the <a href="https://msdn.microsoft.com/library/windows/hardware/ff552837">DEVMODEW</a> structure specified in the <i>pvOut</i> parameter in a previous call to this function, for which the <i>iEsc</i> parameter was set to DOCUMENTEVENT_CREATEDCPRE.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_CREATEDCPRE

</td>
<td>
<i>pvIn </i>points to a <a href="https://msdn.microsoft.com/library/windows/hardware/ff547612">DOCEVENT_CREATEDCPRE</a> structure.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_DELETEDC

</td>
<td>
Not used.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_ENDDOCPOST

</td>
<td>
Not used.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_ENDDOCPRE 

or

DOCUMENTEVENT_ENDDOC

</td>
<td>
Not used.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_ENDPAGE

</td>
<td>
Not used.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_ESCAPE

</td>
<td>
<i>pvIn</i> points to a <a href="https://msdn.microsoft.com/library/windows/hardware/ff548377">DOCEVENT_ESCAPE</a> structure.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_QUERYFILTER

</td>
<td>
Same as for DOCUMENTEVENT_CREATEDCPRE.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_RESETDCPOST

</td>
<td>
<i>pvIn</i> contains the address of a pointer to the <a href="https://msdn.microsoft.com/library/windows/hardware/ff552837">DEVMODEW</a> structure specified in the <i>pvOut</i> parameter in a previous call to this function, for which the <i>iEsc</i> parameter was set to DOCUMENTEVENT_RESETDCPRE.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_RESETDCPRE

</td>
<td>
<i>pvIn</i> contains the address of a pointer to the <a href="https://msdn.microsoft.com/library/windows/hardware/ff552837">DEVMODEW</a> structure supplied by the caller of <b>ResetDC</b> (described in the Windows SDK documentation).

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_STARTDOCPOST

</td>
<td>
<i>pvIn</i> points to a LONG that specifies the print job identifier returned by <b>StartDoc</b> (described in the Windows SDK documentation).

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_STARTDOCPRE 

or

DOCUMENTEVENT_STARTDOC

</td>
<td>
<i>pvIn</i> contains the address of a pointer to a DOCINFO structure supplied by the caller of <b>StartDoc</b> (both described in the Windows SDK documentation). 

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_STARTPAGE

</td>
<td>
Not used.

</td>
</tr>
</table>
 


### -param cbOut





#### If iEsc is DOCUMENTEVENT_ESCAPE:

Function-supplied value that is used as the <i>cbOutput</i> parameter for <b>ExtEscape</b>.



#### If iEsc is DOCUMENTEVENT_QUERYFILTER:

Caller-supplied size, in bytes, of the buffer pointer to by <i>pvOut</i>.



#### For all other iEsc values:

Not used.


### -param pvOut [out]

Function-supplied pointer to an output buffer, the use of which is dependent on the value supplied for <i>iEsc</i>, as follows. <b>CreateDC</b>, <b>ExtEscape</b>, and <b>ResetDC</b> are described in the Windows SDK documentation.

<table>
<tr>
<th><i>iEsc</i> Constant</th>
<th><i>pvOut</i> Contents</th>
</tr>
<tr>
<td>
DOCUMENTEVENT_CREATEDCPRE

</td>
<td>
Pointer to a driver-supplied DEVMODEW structure, which GDI uses instead of the one supplied by the <b>CreateDC</b> caller. (If <b>NULL</b>, GDI uses the caller-supplied structure.)

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_ESCAPE

</td>
<td>
Buffer pointer that is used as the <i>lpszOutData</i> parameter for <b>ExtEscape</b>.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_QUERYFILTER

</td>
<td>
Caller-supplied pointer to buffer containing a <a href="https://msdn.microsoft.com/library/windows/hardware/ff548389">DOCEVENT_FILTER</a> structure.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_RESETDCPRE

</td>
<td>
Pointer to a driver-supplied DEVMODEW structure, which GDI uses instead of the one supplied by the <b>ResetDC</b> caller. (If <b>NULL</b>, GDI uses the caller-supplied structure.)

</td>
</tr>
<tr>
<td>
All other <i>iEsc</i> values

</td>
<td>
Not used.

</td>
</tr>
</table>
 


## -returns



The function's return value is dependent on the escape supplied for <i>iEsc</i>. For some escape codes, the return value is not used (see the second list of values). If the function supplies a return value, it must be one of the following:

<table>
<tr>
<th>Return code</th>
<th>Description</th>
</tr>
<tr>
<td width="40%">
<dl>
<dt><b>DOCUMENTEVENT_FAILURE</b></dt>
</dl>
</td>
<td width="60%">
The driver supports the escape code identified by <i>iEsc</i>, but a failure occurred.

</td>
</tr>
<tr>
<td width="40%">
<dl>
<dt><b>DOCUMENTEVENT_SUCCESS</b></dt>
</dl>
</td>
<td width="60%">
The driver successfully handled the escape code identified by <i>iEsc</i>.

</td>
</tr>
<tr>
<td width="40%">
<dl>
<dt><b>DOCUMENTEVENT_UNSUPPORTED</b></dt>
</dl>
</td>
<td width="60%">
The driver does not support the escape code identified by <i>iEsc</i>.

</td>
</tr>
</table>
 




## -remarks



A <a href="https://msdn.microsoft.com/2a8cf38f-8e27-4e08-9c0f-5d1a4cd854ac">printer interface DLL</a> can optionally provide a <b>DrvDocumentEvent</b> function to perform preprocessing or postprocessing of GDI calls associated with rendering a document. Calls to the <b>DrvDocumentEvent</b> function are made from the user-mode GDI client, when an application makes calls into the GDI client.

For an <i>iEsc</i> value of DOCUMENTEVENT_QUERYFILTER, the spooler can interpret a DOCUMENTEVENT_SUCCESS value returned by <b>DrvDocumentEvent</b> in two ways, depending on whether the driver modified certain members of the <a href="https://msdn.microsoft.com/library/windows/hardware/ff548389">DOCEVENT_FILTER</a> structure. (The <i>pvOut</i> parameter points to this structure.) When the spooler allocates memory for a structure of this type, it initializes two members of this structure, <b>cElementsReturned</b> and <b>cElementsNeeded</b>, to known values. After <b>DrvDocumentEvent</b> returns, the spooler determines whether the values of these members have changed, and uses that information to interpret the <b>DrvDocumentEvent</b> return value. The following table summarizes this situation.

<table>
<tr>
<th rowspan="2">Return Value</th>
<th>Status of cElementsReturned,</th>
<th rowspan="2">Meaning</th>
</tr>
<tr>
<th>cElementsNeeded</th>
</tr>
<tr>
<td>
DOCUMENTEVENT_SUCCESS

</td>
<td>
Driver made no change to either member.

</td>
<td>
The spooler interprets this return value as equivalent to DOCUMENTEVENT_UNSUPPORTED.

The spooler is unable to retrieve the event filter from the driver, so it persists in calling <b>DrvDocumentEvent</b> for all events.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_SUCCESS

</td>
<td>
Driver wrote to one or both members.

</td>
<td>
The spooler accepts this return value without interpretation. If the driver wrote to only one of <b>cElementsNeeded</b> and <b>cElementsReturned</b>, the spooler considers the unchanged member to have a value of zero.

The spooler filters out all events listed in the <b>aDocEventCall</b> member of <a href="https://msdn.microsoft.com/library/windows/hardware/ff548389">DOCEVENT_FILTER</a>.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_UNSUPPORTED

</td>
<td>
Not applicable

</td>
<td>
The driver does not support DOCUMENTEVENT_QUERYFILTER.

The spooler is unable to retrieve the event filter from the driver, so it persists in calling <b>DrvDocumentEvent</b> for all events.

</td>
</tr>
<tr>
<td>
DOCUMENTEVENT_FAILURE

</td>
<td>
Not applicable

</td>
<td>
The driver supports DOCUMENTEVENT_QUERYFILTER, but encountered an internal error.

The spooler is unable to retrieve the event filter from the driver, so it persists in calling <b>DrvDocumentEvent</b> for all events.

</td>
</tr>
</table>
 

If the escape code name has no suffix or is suffixed with PRE, the GDI client calls <b>DrvDocumentEvent</b> just prior to calling the kernel-mode GDI rendering engine. If the escape code name is suffixed with POST, the GDI client calls <b>DrvDocumentEvent</b> just after the kernel-mode GDI rendering engine returns.

If the escape code supplied in the <i>iEsc</i> parameter is DOCUMENTEVENT_CREATEDCPRE, the following rules apply:

<ul>
<li>
If the job is being sent directly to the printer without spooling, <i>pvIn</i> --> pszDevice points to the printer name. (See the <a href="https://msdn.microsoft.com/library/windows/hardware/ff547612">DOCEVENT_CREATEDCPRE</a> structure for more information.)

</li>
<li>
If the job is being spooled, <i>pvIn</i> --> pszDevice points to the printer port name.

</li>
</ul>
The <b>DrvDocumentEvent</b> function executes in the context of the user-mode caller of the GDI client function. When EMF spooling is disabled, the function can display a user interface. For example, the <b>DrvDocumentEvent</b> function for a FAX driver might display a dialog box to the user before GDI's <b>StartDoc</b> function (described in the Microsoft Windows SDK documentation) is processed.

<div class="alert"><b>Note</b>    The following restrictions apply when running a 32-bit application on a 64-bit version of Windows. The only GDI function that <b>DrvDocumentEvent</b> should call is <b>ExtEscape</b>, and only private escapes should be used. <b>DrvDocumentEvent</b> calls to other GDI functions may produce undefined behavior.</div>
<div> </div>



## -see-also




<a href="https://msdn.microsoft.com/library/windows/hardware/ff547612">DOCEVENT_CREATEDCPRE</a>



<a href="https://msdn.microsoft.com/library/windows/hardware/ff548377">DOCEVENT_ESCAPE</a>



<a href="https://msdn.microsoft.com/library/windows/hardware/ff548389">DOCEVENT_FILTER</a>
 

 

